{% extends "layout.html" %}

{% block title %}{{ gene.hgnc_symbol }} - Gene info{% endblock %}

{% block meta %}
  <meta name="description" content="{{ gene.gene_name or gene.gene_description or gene.hgnc_symbol }}">
{% endblock %}

{% block body %}
<div class="w-full h-full overflow-y-auto bg-gray-50">

  <!-- Main Info -->
  <header class="mx-auto max-w-7xl px-4 pt-6">
    <div class="rounded-2xl border-b-4 border-blue-400 bg-white shadow-lg p-5">
      <div class="flex flex-wrap items-start justify-between gap-4">
        <div class="min-w-0">
          <div class="flex flex-wrap items-center gap-2">
            <h1 class="text-3xl font-semibold tracking-tight">{{ gene.hgnc_symbol }}</h1>
            {% if gene.status %}
              <span class="inline-flex items-center rounded-full bg-purple-100 px-2.5 py-0.5 text-xs font-medium text-purple-800">{{ gene.status }}</span>
            {% endif %}
            {% if gene.ensembl_canonical %}
              <span class="inline-flex items-center rounded-full bg-indigo-100 px-2.5 py-0.5 text-xs font-medium text-indigo-800">Ensembl canonical</span>
            {% endif %}
            {% if gene.gene_type %}
              {% for t in gene.gene_type %}
                <span class="inline-flex items-center rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-800">{{ t|replace('_',' ') }}</span>
              {% endfor %}
            {% endif %}
          </div>
          {% if gene.gene_name %}
            <p class="mt-2 text-sm">{{ gene.gene_name }}</p>
          {% endif %}
          {% if gene.gene_description %}
            <p class="mt-1 text-sm">{{ gene.gene_description }}</p>
          {% endif %}

          <!-- Small chrom/cytoband pill (no image) -->
          {% if gene.chromosome or gene.locus %}
          <div class="mt-3 flex flex-wrap items-center gap-2">
            {% if gene.chromosome %}
              <span class="inline-flex items-center rounded-full bg-orange-200 px-2.5 py-1 text-xs font-medium text-orange-700">chr{{ gene.chromosome }} : {{gene.start}} -{{ gene.end }} </span>
            {% endif %}
            {% if gene.locus %}
              <span class="inline-flex items-center rounded-full bg-olive-500 px-2.5 py-1 text-xs font-medium text-white">{{ gene.locus }}</span>
            {% endif %}
          </div>
          {% endif %}
        </div>

        <!-- Actions -->
        <div class="flex flex-wrap items-center gap-2">
          <a href="{{ url_for('public_bp.assay_catalog') }}"
              class="inline-flex items-center gap-2 rounded-2xl bg-blue-300 px-3 py-2 text-sm font-medium shadow hover:bg-blue-400">
            Back to Catalog
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Content -->
  <main class="mx-auto max-w-7xl px-4 pb-16 space-y-6 pt-6">

    <!-- Quick links (colorful chips) -->
    <section class="rounded-2xl border-b-4 border-gray-600 bg-white shadow-lg p-4">
      <div class="flex flex-wrap items-center gap-2 text-sm">
        {% if gene.hgnc_id %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-blue-400 hover:bg-blue-400 transition duration-300 hover:text-white"
              href="https://www.genenames.org/data/gene-symbol-report/#!/hgnc_id/{{ gene.hgnc_id }}" target="_blank" rel="noopener">HGNC</a>
        {% endif %}
        {% if gene.entrez_id %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-indigo-400 hover:bg-indigo-400 transition duration-300 hover:text-white"
              href="https://www.ncbi.nlm.nih.gov/gene/{{ gene.entrez_id }}" target="_blank" rel="noopener">NCBI Gene</a>
        {% endif %}
        {% if gene.ensembl_gene_id %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-purple-400 hover:bg-purple-400 transition duration-300 hover:text-white"
              href="https://www.ensembl.org/Homo_sapiens/Gene/Summary?g={{ gene.ensembl_gene_id }}" target="_blank" rel="noopener">Ensembl</a>
        {% endif %}
        {% if gene.ensembl_mane_select %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-yellow-400 hover:bg-yellow-400 transition duration-300 hover:text-white"
              href="https://www.ensembl.org/Homo_sapiens/Transcript/Summary?t={{ gene.ensembl_mane_select }}" target="_blank" rel="noopener">MANE (Ensembl)</a>
        {% endif %}
        {% if gene.refseq_mane_select %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-orange-400 hover:bg-orange-400 transition duration-300 hover:text-white"
              href="https://www.ncbi.nlm.nih.gov/nuccore/{{ gene.refseq_mane_select }}" target="_blank" rel="noopener">MANE (RefSeq)</a>
        {% endif %}
        {% if gene.omim_id and gene.omim_id|length %}
          {% for om in gene.omim_id[:3] %}
            <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-brown-400 hover:bg-brown-400 transition duration-300 hover:text-white"
              href="https://www.omim.org/entry/{{ om }}" target="_blank" rel="noopener">OMIM</a>
          {% endfor %}
          {% if gene.omim_id|length > 3 %}<span>+{{ gene.omim_id|length - 3 }}</span>{% endif %}
        {% endif %}
        {% if gene.cosmic and gene.cosmic|length %}
          {% for cs in gene.cosmic[:1] %}
            <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-teal-400 hover:bg-teal-400 transition duration-300 hover:text-white"
              href="https://cancer.sanger.ac.uk/cosmic/gene/analysis?ln={{ cs }}" target="_blank" rel="noopener">COSMIC</a>
          {% endfor %}
        {% endif %}
        {% if gene.chromosome and gene.start and gene.end %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-gray-600 hover:bg-gray-600 transition duration-300 hover:text-white"
            href="https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg38&position=chr{{ gene.chromosome }}%3A{{ gene.start }}-{{ gene.end }}"
            target="_blank" rel="noopener">UCSC hg38</a>
        {% endif %}
        {% if gene.hgnc_symbol %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-green-400 hover:bg-green-400 transition duration-300 hover:text-white"
            href="https://www.genecards.org/cgi-bin/carddisp.pl?gene={{ gene.hgnc_symbol }}"
            target="_blank" rel="noopener">GeneCards</a>

        {% endif %}
        {% if gene.hgnc_symbol %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-blue-400 hover:bg-blue-400 transition duration-300 hover:text-white"
            href="https://www.oncokb.org/gene/{{ gene.hgnc_symbol }}"
            target="_blank" rel="noopener">OncoKB</a>
        {% endif %}
        {% if gene.hgnc_symbol %}
          {% set clinvar_somatic_q = '("' ~ gene.hgnc_symbol ~ '"[GENE] AND (("somatic_clinical_impact_classification"[PROP] OR "oncogenicity_classification"[PROP]) AND ("reviewed by expert panel"[Review status])))' %}
          <a class="inline-flex items-center gap-2 rounded-3xl bg-gray-100 px-3 py-2 text-sm font-medium text-black shadow-lg border-l-8 border-red-600 hover:bg-red-600 transition duration-300 hover:text-white"
              href="https://www.ncbi.nlm.nih.gov/clinvar?term={{ clinvar_somatic_q|urlencode }}"
              target="_blank" rel="noopener">ClinVar</a>
        {% endif %}
      </div>
    </section>

    <!-- Main cards -->
    <section class="grid grid-cols-3 gap-4">
      <!-- Identifiers -->
      <div class="rounded-2xl bg-white shadow-md border border-t-4 border-purple-400">
        <div class="p-5">
          <h2 class="text-base font-semibold">Identifiers</h2>
          <dl class="mt-3 space-y-2 text-sm">
            {% if gene.hgnc_id %}
              <div class="flex items-center justify-between gap-3">
                <dt>HGNC</dt>
                <dd class="font-semibold">
                  {{ gene.hgnc_id }}
                </dd>
              </div>
            {% endif %}
            {% if gene.entrez_id %}
              <div class="flex items-center justify-between gap-3">
                <dt>NCBI Gene</dt>
                <dd class="font-semibold">
                  <a class="text-indigo-700 hover:underline" target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/gene/{{ gene.entrez_id }}">{{ gene.entrez_id }}</a>
                </dd>
              </div>
            {% endif %}
            {% if gene.ensembl_gene_id %}
              <div class="flex items-center justify-between gap-3">
                <dt>Ensembl</dt>
                <dd class="font-semibold break-all">
                  <a class="text-indigo-700 hover:underline" target="_blank" rel="noopener" href="https://www.ensembl.org/Homo_sapiens/Gene/Summary?g={{ gene.ensembl_gene_id }}">{{ gene.ensembl_gene_id }}</a>
                </dd>
              </div>
            {% endif %}
            {% if gene.refseq_accession and gene.refseq_accession|length %}
              <div class="flex items-center justify-between gap-3">
                <dt>RefSeq</dt>
                <dd class="font-semibold break-all">
                  <div class="flex flex-wrap justify-end items-center gap-1">
                  {% for acc in gene.refseq_accession[:5] %}
                    <a class="inline-flex items-center rounded-full bg-gray-200 px-1.5 py-0.5 text-sm font-semibold hover:bg-gray-300"
                    target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/nuccore/{{ acc }}">{{ acc }}</a>
                  {% endfor %}
                  {% if gene.refseq_accession|length > 5 %}
                    <span class="inline-flex items-center rounded-full bg-slate-100 px-2 py-1 text-xs font-semibold text-slate-700">+{{ gene.refseq_accession|length - 5 }} more</span>
                  {% endif %}
                  </div>
                </dd>
              </div>
            {% endif %}
          </dl>
        </div>
      </div>

      <!-- Genomic location -->
      <div class="rounded-2xl bg-white shadow-md border border-t-4 border-indigo-400">
        <div class="p-5">
          <h2 class="text-base font-semibold">Genomic location</h2>
          <dl class="mt-3 space-y-2 text-sm">
            {% if gene.locus %}<div class="flex items-center justify-between gap-3"><dt>Cytoband</dt><dd class="font-semibold">{{ gene.locus }}</dd></div>{% endif %}
            {% if gene.chromosome %}<div class="flex items-center justify-between gap-3"><dt>Chromosome</dt><dd class="font-semibold">chr{{ gene.chromosome }}</dd></div>{% endif %}
            {% if gene.start and gene.end %}
              <div class="flex items-center justify-between gap-3">
                <dt>Coordinates</dt>
                <dd class="font-semibold">
                    chr{{ gene.chromosome }}:{{ gene.start }}-{{ gene.end }}
                  </button>
                </dd>
              </div>
              <div class="flex items-center justify-between gap-3">
                <dt>Length</dt>
                <dd class="font-semibold">{{ gene.end - gene.start + 1 }}</dd>
              </div>
            {% endif %}
            {% if gene.gene_gc_content is not none %}
              <div class="flex items-center justify-between gap-3">
                <dt>GC content</dt>
                <dd class="font-semibold">{{ '%.2f'|format(gene.gene_gc_content) }}%</dd>
              </div>
            {% endif %}
          </dl>
          {% if gene.ensembl_gene_id or (gene.chromosome and gene.start and gene.end) %}
            <div class="mt-3 flex flex-wrap gap-2">
              {% if gene.ensembl_gene_id %}
                <a class="text-xs inline-flex items-center rounded-2xl border border-indigo-400 bg-indigo-100 px-2 py-1 text-indigo-700 hover:bg-indigo-300"
                  target="_blank" rel="noopener"
                  href="https://www.ensembl.org/Homo_sapiens/Location/View?g={{ gene.ensembl_gene_id }}">Ensembl locus</a>
              {% endif %}
              {% if gene.chromosome and gene.start and gene.end %}
                <a class="text-xs inline-flex items-center rounded-2xl border border-indigo-400 bg-indigo-100 px-2 py-1 text-indigo-700 hover:bg-indigo-300"
                  target="_blank" rel="noopener"
                  href="https://genome.ucsc.edu/cgi-bin/hgTracks?db=hg38&position=chr{{ gene.chromosome }}%3A{{ gene.start }}-{{ gene.end }}">UCSC hg38</a>
              {% endif %}
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Transcripts -->
      <div class="rounded-2xl bg-white shadow-md border border-t-4 border-blue-400">
        <div class="p-5">
          <h2 class="text-base font-semibold ">Transcripts</h2>
          <dl class="mt-3 space-y-2 text-sm">
            {% if gene.refseq_mane_select %}
              <div class="flex items-center justify-between">
                <dt>MANE (RefSeq)</dt>
                <dd class="font-semibold"><a class="hover:underline" target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/nuccore/{{ gene.refseq_mane_select }}">{{ gene.refseq_mane_select }}</a></dd>
              </div>
            {% endif %}
            {% if gene.ensembl_mane_select %}
              <div class="flex items-center justify-between">
                <dt>MANE (Ensembl)</dt>
                <dd class="font-semibold"><a class="hover:underline" target="_blank" rel="noopener" href="https://www.ensembl.org/Homo_sapiens/Transcript/Summary?t={{ gene.ensembl_mane_select }}">{{ gene.ensembl_mane_select }}</a></dd>
              </div>
            {% endif %}

            {% if gene.refseq_mane_plus_clinical and gene.refseq_mane_plus_clinical|length %}
              <div class="flex items-center justify-between">
                <dt>MANE Plus Clinical</dt>
                <dd class="mt-1 space-y-1">
                  {% for acc in gene.refseq_mane_plus_clinical %}
                    <a class="block font-semibold hover:underline" target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/nuccore/{{ acc }}">{{ acc }}</a>
                  {% endfor %}
                </dd>
              </div>
            {% endif %}

            {% if gene.addtional_transcript_info %}
              <div class="mt-2">
                <dt>Additional transcripts</dt>
                <dd class="mt-2 overflow-hidden rounded-xl">
                  <div class="overflow-x-auto rounded-2xl shadow-3xl relative">
                    <table class="min-w-full bg-transparent shadow-md rounded-2xl text-xs my-2 overflow-hidden">
                      <thead class="rounded-t-2xl overflow-hidden border-gray-800">
                        <tr class="border-b text-left border-gray-800 bg-blue-200 uppercase tracking-wider shadow-xl rounded-t-2xl">
                          <th class="p-2 font-normal">Accession</th>
                          <th class="p-2 font-normal">Start</th>
                          <th class="p-2 font-normal">End</th>
                          <th class="p-2 font-normal">Length</th>
                        </tr>
                      </thead>
                      <tbody class="text-gray-800 rounded-b-2xl overflow-hidden">
                        {% for acc, info in gene.addtional_transcript_info.items() %}
                          <tr class="border-t border-gray-400 hover:bg-blue-100 text-left last:rounded-b-2xl">
                            <td class="p-2 font-medium">
                              <a class="text-indigo-700 hover:underline" target="_blank" rel="noopener" href="https://www.ncbi.nlm.nih.gov/nuccore/{{ acc }}">{{ acc }}</a>
                            </td>
                            <td class="p-2 font-medium">{{ info.start }}</td>
                            <td class="p-2 font-medium">{{ info.end }}</td>
                            <td class="p-2 font-medium">{{ info.length }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </dd>
              </div>
            {% endif %}
          </dl>
        </div>
      </div>
    </section>

    <!-- Aliases & names -->
    <section class="grid grid-cols-2 gap-4">
      <div class="rounded-2xl bg-white shadow-md border border-t-4 border-orange-400">
        <div class="p-5">
          <h2 class="text-base font-semibold">Aliases</h2>
          <div class="mt-3 flex flex-wrap gap-2 text-sm">
            {% if gene.alias_symbol and gene.alias_symbol|length %}
              {% for a in gene.alias_symbol %}
                <span class="rounded-full bg-gray-200 px-3 py-1">{{ a }}</span>
              {% endfor %}
            {% else %}
              <span>-</span>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-white shadow-md border border-t-4 border-brown-400">
        <div class="p-5">
          <h2 class="text-base font-semibold ">Previous symbols & names</h2>
          <div class="mt-3 text-sm">
            <div class="mb-2">
              <div class="font-semibold">Previous symbols</div>
              <div class="mt-1 flex flex-wrap gap-2">
                {% if gene.prev_symbol and gene.prev_symbol|length %}
                  {% for s in gene.prev_symbol %}
                    <span class="rounded-full bg-gray-200 px-3 py-1">{{ s }}</span>
                  {% endfor %}
                {% else %}
                  <span>-</span>
                {% endif %}
              </div>
            </div>
            <div>
              <div class="font-semibold">Previous names</div>
              <ul class="mt-1 list-disc pl-5 space-y-1">
                {% if gene.prev_name and gene.prev_name|length %}
                  {% for n in gene.prev_name %}<li>{{ n }}</li>{% endfor %}
                {% else %}
                  <li>-</li>
                {% endif %}
              </ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Metadata -->
    <section class="rounded-2xl bg-white shadow-md border border-t-4 border-gray-600">
      <div class="p-5">
        <h2 class="text-base font-semibold ">Metadata</h2>
        <dl class="mt-3 grid grid-cols-4 gap-4 text-sm">
          {% if gene.date_approved_reserved %}<div><dt class="font-semibold">Approved</dt><dd class="font-medium">{{ gene.date_approved_reserved[:10] }}</dd></div>{% endif %}
          {% if gene.date_symbol_changed %}<div><dt class="font-semibold">Symbol changed</dt><dd class="font-medium">{{ gene.date_symbol_changed[:10] }}</dd></div>{% endif %}
          {% if gene.date_name_changed %}<div><dt class="font-semibold">Name changed</dt><dd class="font-medium">{{ gene.date_name_changed[:10] }}</dd></div>{% endif %}
          {% if gene.date_modified %}<div><dt class="font-semibold">Last modified</dt><dd class="font-medium">{{ gene.date_modified[:10] }}</dd></div>{% endif %}
        </dl>
      </div>
    </section>

  </main>
</div>

{% endblock %}
