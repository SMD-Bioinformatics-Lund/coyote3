{% extends "layout.html" %}
{% block title %}Update Gene Panel{% endblock %}
{% block style %}
  <link href="{{ url_for('genepanels_bp.static', filename='css/style.css') }}" rel="stylesheet">
{% endblock %}

{% block javascript %}
    <script>
        const validateNameUrl = '{{ url_for("genepanels_bp.validate_name") }}';
        const validateDisplayNameUrl = '{{ url_for("genepanels_bp.validate_displayname") }}';
        const validateVersionUrl = '{{ url_for("genepanels_bp.validate_version", genepanel_id=panel_data["_id"]) }}';
        const panelId = '{{ panel_data["_id"] }}';
        const availableAssaysJson = '{{ available_assays|tojson }}'; // Inject available assays as a JSON string
    </script>
    <script src="{{ url_for('genepanels_bp.static', filename='js/update_genelist.js') }}"></script>
{% endblock %}

{% block body %}

<div class="flex w-full h-full overflow-hidden">
  <main class="flex-1 bg-transparent overflow-y-auto p-4 flex flex-col items-center">
    <section id="edit-genepanel-section" class="bg-blue-50 shadow-lg rounded-xl px-6 py-6 my-4 border border-gray-200 w-full max-w-3xl">

      <h2 class="text-xl text-center font-semibold text-black tracking-wide uppercase">Edit Gene Panel</h2>

      <form id="genePanelForm" action="{{ url_for('genepanels_bp.edit_genepanel', genepanel_id=panel_data['_id']) }}" method="post" enctype="multipart/form-data" class="space-y-2 text-sm">
        {{ form.hidden_tag() }}

        <!-- Name -->
        <div>
          {{ form.name.label(class="block font-medium text-gray-700 mb-1") }}
          {{ form.name(class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400", placeholder="Enter name", id="nameField") }}
          <span id="nameError" class="text-sm text-red-500 mt-1 block"></span>
        </div>

        <!-- Display Name -->
        <div>
          {{ form.displayname.label(class="block font-medium text-gray-700 mb-1") }}
          {{ form.displayname(class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400", placeholder="Enter display name", id="displaynameField") }}
          <span id="displaynameError" class="text-sm text-red-500 mt-1 block"></span>
        </div>

        <!-- Type -->
        <div>
          {{ form.type.label(class="block font-medium text-gray-700 mb-1") }}
          {{ form.type(class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400") }}
        </div>

        <!-- Genes File -->
        <div>
          {{ form.genes_file.label(class="block font-medium text-gray-700 mb-1") }}
          {{ form.genes_file(class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400") }}
          <span class="text-sm text-gray-500 mt-1 block">or</span>

          <!-- Manual Genes Input -->
          <div id="genes-input-container" class="w-full border border-gray-300 rounded-lg px-4 py-2 mt-2 flex flex-wrap items-center bg-white shadow-inner">
            <input type="text" id="genes-input" class="flex-grow outline-none text-sm" placeholder="Type genes here..." autocomplete="off">
          </div>
          <input type="hidden" name="genes_text" id="genes_field" value="{{ form.genes_text.data }}">
        </div>

        <!-- Assays -->
        <div>
          {{ form.assays.label(class="block font-medium text-gray-700 mb-1") }}
          <div id="assays-input-container" class="w-full border border-gray-300 rounded-lg px-4 py-2 mt-2 flex flex-wrap items-center bg-white shadow-inner">
            <input type="text" id="assays-input" class="flex-grow outline-none text-sm" placeholder="Type assays here..." autocomplete="off">
          </div>
          <input type="hidden" name="assays" id="assays_field" value="{{ form.assays.data }}">
          <div id="assay-suggestions" class="mt-2 flex flex-wrap gap-2">
            <!-- Suggestions will appear here -->
          </div>
        </div>

        <!-- Version -->
        <div>
          {{ form.version.label(class="block font-medium text-gray-700 mb-1") }}
          {{ form.version(class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm focus:ring-2 focus:ring-indigo-400", placeholder="Enter version", id="versionField") }}
          <span id="versionError" class="text-sm text-red-500 mt-1 block"></span>
        </div>

        <!-- Submit -->
        <div class="pt-4 flex justify-center">
          {{ form.submit(class="bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-6 rounded-lg transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-400") }}
        </div>

      </form>
    </section>
  </main>
</div>



{% endblock %}