{% extends "layout.html" %}
{% block title %}Change Password{% endblock %}
{% block body %}
<div class="flex w-full h-full overflow-hidden">
  <main class="flex-1 bg-transparent overflow-y-auto p-4 flex flex-col items-center">
    <section id="change-password-section" class="bg-blue-50 shadow-lg rounded-xl px-6 py-6 my-4 border border-gray-200 w-full max-w-md">

      <h1 class="text-xl text-center font-semibold text-black tracking-wide uppercase">Change Password</h1>

      <form method="POST" name="form" class="space-y-6 text-sm">
        {{ form.csrf_token }}

        <!-- Old Password -->
        <div>
          <label for="old_password" class="block font-medium text-gray-700 mb-1">
            {{ form.old_password.label }}
          </label>
          {{ form.old_password(
            class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm text-gray-900 focus:ring-2 focus:ring-indigo-400"
          ) }}
          {% for error in form.old_password.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
          {% endfor %}
        </div>

        <!-- New Password -->
        <div>
          <label for="new_password" class="block font-medium text-gray-700 mb-1">
            {{ form.new_password.label }}
          </label>
          {{ form.new_password(
            id="new_password",
            class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm text-gray-900 focus:ring-2 focus:ring-indigo-400"
          ) }}
          <p id="passwordHelpBlock" class="text-xs text-gray-500 mt-1">
            Password must be at least 15 characters long, contain an uppercase letter, a number, and a special character.
          </p>
          <div id="passwordFeedback" class="text-xs mt-1"></div>
        </div>

        <!-- Confirm Password -->
        <div>
          <label for="confirm_password" class="block font-medium text-gray-700 mb-1">
            {{ form.confirm_password.label }}
          </label>
          {{ form.confirm_password(
            id="confirm_password",
            class="w-full border border-gray-300 rounded-lg px-4 py-2 shadow-sm text-gray-900 focus:ring-2 focus:ring-indigo-400"
          ) }}
          <div id="confirmPasswordFeedback" class="text-xs mt-1"></div>
        </div>

        <!-- Submit Button -->
        <div class="pt-4">
          <button type="submit"
                  class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-medium py-2 px-4 rounded-lg transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-400">
            Change Password
          </button>
        </div>
      </form>

    </section>
  </main>
</div>


<script>
  document.addEventListener('DOMContentLoaded', (event) => {
    const newPassword = document.querySelector('#new_password');
    const confirmPassword = document.querySelector('#confirm_password');
    const passwordFeedback = document.querySelector('#passwordFeedback');
    const confirmPasswordFeedback = document.querySelector('#confirmPasswordFeedback');

    const validatePassword = () => {
      const password = newPassword.value;
      const confirmPass = confirmPassword.value;
      const lengthValid = password.length >= 15;
      const uppercaseValid = /[A-Z]/.test(password);
      const numberValid = /\d/.test(password);
      const specialCharValid = /[\W_]/.test(password);

      let message = '';

      if (!lengthValid) {
          message += 'Password must be at least 15 characters long. ';
      }
      if (!uppercaseValid) {
          message += 'Password must contain at least one uppercase letter. ';
      }
      if (!numberValid) {
          message += 'Password must contain at least one digit. ';
      }
      if (!specialCharValid) {
          message += 'Password must contain at least one special character. ';
      }

      if (lengthValid && uppercaseValid && numberValid && specialCharValid) {
        passwordFeedback.textContent = 'Password is strong';
        passwordFeedback.classList.remove('text-red-600');
        passwordFeedback.classList.add('text-green-600');
      } else {
        passwordFeedback.textContent = message;
        passwordFeedback.classList.remove('text-green-600');
        passwordFeedback.classList.add('text-red-600');
      }

      if (confirmPass && password !== confirmPass) {
        confirmPasswordFeedback.textContent = 'Passwords do not match';
        confirmPasswordFeedback.classList.remove('text-green-600');
        confirmPasswordFeedback.classList.add('text-red-600');
      } else if (confirmPass) {
        confirmPasswordFeedback.textContent = 'Passwords match';
        confirmPasswordFeedback.classList.remove('text-red-600');
        confirmPasswordFeedback.classList.add('text-green-600');
      } else {
        confirmPasswordFeedback.textContent = '';
      }
    };

    newPassword.addEventListener('input', validatePassword);
    confirmPassword.addEventListener('input', validatePassword);
  });
</script>
{% endblock %}
