{% extends "layout.html" %}
{% block title %}View Assay Panel{% endblock %}
{% block body %}
<div class="flex w-full h-full overflow-hidden">
  {% include "admin_sidebar.html" %}
  <main class="flex-1 overflow-y-auto p-6 flex flex-col">

    <section class="p-2 ml-2 mt-2">

      <div class="bg-gray-50 border border-gray-200 rounded-2xl shadow-xl p-6">

        <!-- Panel Header -->
        <div class="flex items-center justify-between mb-6">
          <div class="text-sm text-gray-700 flex items-center">
            <span class="inline-flex items-center px-2 py-1 bg-orange-200 text-black font-semibold rounded-l-full">
              {{ panel._id }}
            </span>
            <span class="inline-flex items-center px-2 py-1 bg-blue-200 text-blue-700 font-semibold rounded-r-full">
              {{ panel.panel_group }}
            </span>
          </div>
          <div class="text-sm text-gray-700 flex items-center">
            <span class="inline-flex items-center px-2 py-1 bg-blue-200 text-blue-700 font-semibold rounded-l-full">
              {{ panel.schema_name }}
            </span>
            <span class="inline-flex items-center px-2 py-1 bg-orange-200 text-black font-semibold rounded-r-full">
              v{{ panel.schema_version }}
            </span>
          </div>
        </div>

        <!-- Sections dynamically -->
        {% for section_name, keys in schema.sections.items() %}
          {% if section_name != "genes" and section_name != "audit" %}
          <div class="mb-6 border-l-4 border-blue-200 bg-blue-50 rounded-xl p-4 shadow-lg">
            <h2 class="text-sm font-bold text-blue-700 uppercase tracking-wide mb-2">
              {{ section_name.replace('_', ' ') }}
            </h2>

            <div class="grid grid-cols-2 gap-4">
              {% for key in keys %}
                {% if key in schema.fields %}
                  <div class="space-y-1">
                    <label class="text-xs font-semibold text-gray-700 block">
                      {{ schema.fields[key].label }}
                      <span class="text-gray-400">({{ schema.fields[key].type }})</span>
                    </label>
                    <div class="bg-white border border-gray-300 rounded-md px-3 py-2 text-sm text-gray-800 min-h-[42px] flex items-center">
                      {{ panel.get(key) if panel.get(key) else '-' }}
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          </div>
          {% endif %}
        {% endfor %}

        <!-- Covered Genes -->
        <div class="mb-6 border-l-4 border-blue-200 bg-blue-50 rounded-xl p-4 shadow-lg">
          <h2 class="text-sm font-bold text-blue-700 uppercase tracking-wide mb-2">
            Covered Genes ({{ panel.covered_genes | length }})
          </h2>

          <div class="bg-white border border-gray-300 rounded-md p-4 max-h-72 overflow-y-auto text-xs font-mono">
            {% if panel.covered_genes %}

              <div class="flex flex-wrap gap-2">
                {% for gene in panel.covered_genes %}
                  <span class="bg-blue-200 text-blue-800 px-2 py-1 rounded-full">{{ gene }}</span>
                {% endfor %}
              </div>
            {% else %}
              <p class="text-gray-500">No covered genes provided.</p>
            {% endif %}
          </div>
        </div>

        <!-- Audit Metadata -->
        <div class="mb-6 border-l-4 border-blue-200 bg-blue-50 rounded-xl p-4 shadow-lg">
          <h2 class="text-sm font-bold text-blue-700 uppercase tracking-wide mb-2">
            Audit Metadata
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            {% for key in schema.sections.audit %}
              {% if key in schema.fields and key != "version" %}
                <div class="space-y-1">
                  <label class="text-xs font-semibold text-gray-700 block">
                    {{ schema.fields[key].label }}
                    <span class="text-gray-400">({{ schema.fields[key].type }})</span>
                  </label>
                  <div class="bg-white border border-gray-300 rounded-md px-3 py-2 text-xs text-gray-600 min-h-[42px] flex items-center">
                    {{ panel.get(key) if panel.get(key) else '-' }}
                  </div>
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

      </div>

    </section>

  </main>
</div>
{% endblock %}
